<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Portal Home: Add "Notas" tile -->
    <template id="portal_my_home_university" name="Show Grades" inherit_id="portal.portal_my_home" priority="40">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-set="is_student" t-value="request.env['university.student'].sudo().search_count([('user_id', '=', request.env.user.id)]) &gt; 0"/>
            <t t-if="is_student">
                <!-- Custom Styled "Notas" Tile -->
                <a href="/my/grades" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between p-3 border-0 shadow-sm mb-2 rounded mt-2">
                    <div class="d-flex align-items-center">
                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px;">
                            <i class="fa fa-graduation-cap fa-xl"/>
                        </div>
                        <div>
                            <h5 class="mb-0 fw-bold text-dark">Notas</h5>
                            <div class="small text-muted">Historial académico y calificaciones</div>
                        </div>
                    </div>
                    <span class="badge bg-secondary rounded-pill" t-out="grade_count or 0"/>
                </a>
            </t>
        </xpath>
    </template>

    <!-- Breadcrumb -->
    <template id="portal_my_home_menu_university" name="Portal layout : Grades menu" inherit_id="portal.portal_breadcrumbs" priority="40">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'grade'" class="breadcrumb-item active">
                Notas
            </li>
        </xpath>
    </template>

    <!-- Grades List View -->
    <template id="portal_my_grades" name="My Grades">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Notas</t>
            </t>

            <div t-if="not grades" class="alert alert-info mt8 text-center" role="alert">
                <i class="fa fa-info-circle me-1"/> No tienes notas registradas aún.
            </div>

            <div t-if="grades" class="card border-0 shadow-sm mt-3">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="py-3 px-4 text-uppercase text-secondary small font-weight-bold border-0"><i class="fa fa-calendar me-2"/>Fecha</th>
                                    <th class="py-3 px-4 text-uppercase text-secondary small font-weight-bold border-0"><i class="fa fa-book me-2"/>Asignatura</th>
                                    <th class="py-3 px-4 text-uppercase text-secondary small font-weight-bold border-0"><i class="fa fa-user me-2"/>Profesor</th>
                                    <th class="py-3 px-4 text-uppercase text-secondary small font-weight-bold border-0 text-end"><i class="fa fa-graduation-cap me-2"/>Nota</th>
                                    <th class="py-3 px-4 text-uppercase text-secondary small font-weight-bold border-0 text-center">Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="grades" t-as="grade">
                                    <tr>
                                        <td class="align-middle px-4"><span t-field="grade.date"/></td>
                                        <td class="align-middle px-4 font-weight-bold text-dark"><span t-field="grade.enrollment_id.subject_id.name"/></td>
                                        <td class="align-middle px-4 text-muted">
                                            <span t-if="grade.enrollment_id.professor_id" t-field="grade.enrollment_id.professor_id.name"/>
                                            <span t-else="" class="text-muted small">N/A</span>
                                        </td>
                                        <td class="align-middle px-4 text-end">
                                            <span class="h5 mb-0 font-weight-bold" t-field="grade.score" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                        <td class="align-middle px-4 text-center">
                                            <t t-if="grade.score &gt;= 9">
                                                <span class="badge rounded-pill bg-warning text-dark"><i class="fa fa-star me-1"/>Sobresaliente</span>
                                            </t>
                                            <t t-elif="grade.score &gt;= 5">
                                                <span class="badge rounded-pill bg-success"><i class="fa fa-check me-1"/>Aprobado</span>
                                            </t>
                                            <t t-else="">
                                                <span class="badge rounded-pill bg-danger"><i class="fa fa-times me-1"/>Suspenso</span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
